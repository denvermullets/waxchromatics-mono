<%#
  Inline connection detail â€” sits within the timeline below its edge pill
  Locals: edge, index
%>

<div
  data-edge-detail-target="detail"
  data-edge-index="<%= index %>"
  class="hidden relative pl-10 py-1"
>
  <div
    class="
      bg-woodsmoke-925 border border-woodsmoke-800 border-l-2
      border-l-crusta-500/50 rounded-sm p-5 ml-0
    "
  >
    <h3 class="text-xs font-semibold tracking-widest text-crusta-400 uppercase mb-3">
      Connection Detail
    </h3>

    <%# Prose summary %>
    <p class="text-woodsmoke-200 mb-5">
      <%= link_to edge[:from_artist].name, artist_path(edge[:from_artist]), class: "text-woodsmoke-50 font-medium hover:text-crusta-400 transition-colors" %>

      <span class="text-woodsmoke-400">
        &mdash; <%= edge[:role].presence&.downcase || "credited on" %> &mdash;
      </span>

      <%= link_to edge[:to_artist].name, artist_path(edge[:to_artist]), class: "text-woodsmoke-50 font-medium hover:text-crusta-400 transition-colors" %>
    </p>

    <%# Release card %>
    <% if edge[:release] %>
      <p
        class="
          text-xs font-semibold tracking-widest text-woodsmoke-500 uppercase
          mb-3
        "
      >
        Related Release
      </p>
      <% release = edge[:release] %>
      <% rg = edge[:release_group] %>
      <% art_url = rg&.cover_art_url || release.cover_art_url %>
      <%= link_to artist_release_group_path(edge[:from_artist], rg || release),
            class: "block bg-woodsmoke-950 border border-woodsmoke-800 rounded-sm p-4 hover:border-woodsmoke-600 transition-colors" do %>
        <div class="flex items-center gap-4">
          <% if art_url.present? %>
            <%= image_tag art_url, alt: release.title, class: "w-14 h-14 rounded object-cover flex-shrink-0" %>
          <% else %>
            <div
              class="
                w-14 h-14 rounded bg-woodsmoke-800 flex items-center
                justify-center flex-shrink-0
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-woodsmoke-600"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"
                />
              </svg>
            </div>
          <% end %>

          <div class="min-w-0 flex-1">
            <p class="text-sm font-semibold text-woodsmoke-100">
              <%= release.title %>
            </p>

            <div class="flex flex-wrap items-center gap-1.5 mt-1.5">
              <% if rg&.year.present? %>
                <span
                  class="
                    px-2 py-0.5 text-xs rounded border border-woodsmoke-700
                    text-woodsmoke-400
                  "
                >
                  <%= rg.year %>
                </span>
              <% end %>

              <% if rg&.release_type.present? %>
                <span
                  class="
                    px-2 py-0.5 text-xs rounded border border-woodsmoke-700
                    text-woodsmoke-400
                  "
                >
                  <%= rg.release_type %>
                </span>
              <% end %>

              <% release.labels.each do |label| %>
                <span
                  class="
                    px-2 py-0.5 text-xs rounded border border-woodsmoke-700
                    text-woodsmoke-400
                  "
                >
                  <%= label.name %>
                </span>
              <% end %>

              <% release.release_formats.each do |fmt| %>
                <span
                  class="
                    px-2 py-0.5 text-xs rounded border border-woodsmoke-700
                    text-woodsmoke-400
                  "
                >
                  <%= fmt.name %>
                </span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
