<div class="container mx-auto px-5 py-8">
  <%# Header: count + filter toggle %>
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-woodsmoke-50">
      Artists
      <span class="text-base font-normal text-woodsmoke-500">(<%= @pagy.count %>)</span>
    </h1>

    <div class="flex gap-1 bg-woodsmoke-950 rounded-lg p-1">
      <%= link_to artists_path(filter: "primary", letter: @letter),
                  class: "px-4 py-1.5 text-sm font-medium rounded-md transition-colors #{@filter == 'primary' ? 'bg-woodsmoke-800 text-woodsmoke-50' : 'text-woodsmoke-400 hover:text-woodsmoke-200'}" do %>
        Primary Artists
      <% end %>
      <%= link_to artists_path(filter: "all", letter: @letter),
                  class: "px-4 py-1.5 text-sm font-medium rounded-md transition-colors #{@filter == 'all' ? 'bg-woodsmoke-800 text-woodsmoke-50' : 'text-woodsmoke-400 hover:text-woodsmoke-200'}" do %>
        All Artists
      <% end %>
    </div>
  </div>

  <div class="flex gap-8">
    <%# Letter sidebar %>
    <nav class="hidden md:flex flex-col gap-1 sticky top-20 self-start">
      <% ('A'..'Z').each do |char| %>
        <% if @available_letters.include?(char) %>
          <%= link_to char, artists_path(filter: @filter, letter: char),
                      class: "text-sm font-semibold px-2 py-0.5 rounded transition-colors #{@letter == char ? 'text-crusta-400 bg-woodsmoke-800' : 'text-woodsmoke-300 hover:text-crusta-400'}" %>
        <% else %>
          <span class="text-sm font-semibold px-2 py-0.5 text-woodsmoke-700"><%= char %></span>
        <% end %>
      <% end %>

      <% if @letter.present? %>
        <div class="mt-2 border-t border-woodsmoke-800 pt-2">
          <%= link_to "All", artists_path(filter: @filter),
                      class: "text-xs font-semibold px-2 py-0.5 rounded text-crusta-400 hover:text-crusta-300 transition-colors" %>
        </div>
      <% end %>
    </nav>

    <%# Artist list %>
    <div class="flex-1 min-w-0">
      <% if @artists.empty? %>
        <p class="text-woodsmoke-500 text-center py-12">No artists found.</p>
      <% end %>

      <% @grouped_artists.each do |letter, artists| %>
        <div id="letter-<%= letter %>" class="mb-8 scroll-mt-20">
          <div class="flex items-baseline gap-3 mb-3">
            <h2 class="text-3xl font-bold text-crusta-400"><%= letter %></h2>
            <span class="text-sm text-woodsmoke-500"><%= artists.size %> artist<%= artists.size == 1 ? '' : 's' %></span>
          </div>
          <div class="border-t border-crusta-400/30 mb-4"></div>

          <div class="space-y-1">
            <% artists.each do |artist| %>
              <div class="flex items-center justify-between py-2 px-3 rounded-lg hover:bg-woodsmoke-800/50 transition-colors">
                <%= link_to artist.name, artist_path(artist),
                            class: "font-medium text-woodsmoke-100 hover:text-crusta-400 transition-colors" %>
                <div class="flex items-center gap-2">
                  <% releases = @release_counts[artist.id] || 0 %>
                  <% variants = @variant_counts[artist.id] || 0 %>
                  <% if releases > 0 %>
                    <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-woodsmoke-800 text-woodsmoke-400">
                      <%= releases %> release<%= releases == 1 ? '' : 's' %>
                    </span>
                  <% end %>
                  <% if variants > 0 %>
                    <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-woodsmoke-800 text-woodsmoke-500">
                      <%= variants %> variant<%= variants == 1 ? '' : 's' %>
                    </span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <%# Pagination %>
      <% if @pagy.last > 1 %>
        <div class="mt-6 flex items-center justify-center gap-3">
          <span class="text-xs text-woodsmoke-500">Page <%= @pagy.page %> of <%= @pagy.last %></span>
          <div class="flex gap-1">
            <% if @pagy.previous %>
              <%= link_to artists_path(filter: @filter, letter: @letter, page: @pagy.previous),
                          class: "px-3 py-1.5 text-sm font-medium rounded-lg border border-woodsmoke-700 text-woodsmoke-200 hover:border-woodsmoke-500 transition-colors" do %>
                &larr; Prev
              <% end %>
            <% end %>
            <% if @pagy.next %>
              <%= link_to artists_path(filter: @filter, letter: @letter, page: @pagy.next),
                          class: "px-3 py-1.5 text-sm font-medium rounded-lg border border-woodsmoke-700 text-woodsmoke-200 hover:border-woodsmoke-500 transition-colors" do %>
                Next &rarr;
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
