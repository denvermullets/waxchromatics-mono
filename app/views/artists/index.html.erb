<div class="container mx-auto px-5 py-8">
  <%# Header: count + filter toggle %>
  <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
    <h1 class="text-2xl font-bold text-woodsmoke-50">
      Artists
      <span class="text-base font-normal text-woodsmoke-500">(<%= @pagy.count %>)</span>
    </h1>

    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-4">
      <%= form_with url: artists_path, method: :get, class: "flex-shrink-0" do |f| %>
        <%= f.hidden_field :filter, value: @filter %>

        <%= f.text_field :q, value: params[:q], placeholder: "Search artists...",
              autocomplete: "off",
              class: "w-full sm:w-48 rounded-sm border border-woodsmoke-700 bg-woodsmoke-925 px-3 py-2 text-sm text-woodsmoke-50 placeholder-woodsmoke-500 focus:border-crusta-400 focus:ring-1 focus:ring-crusta-400 focus:outline-none" %>
      <% end %>

      <div class="flex gap-1 bg-woodsmoke-950 rounded-sm p-1">
        <%= link_to artists_path(filter: "primary", letter: @letter),
                    class: "px-4 py-1.5 text-sm font-medium rounded-sm transition-colors #{@filter == 'primary' ? 'bg-woodsmoke-800 text-woodsmoke-50' : 'text-woodsmoke-400 hover:text-woodsmoke-200'}" do %>
          Primary Artists
        <% end %>

        <%= link_to artists_path(filter: "all", letter: @letter),
                    class: "px-4 py-1.5 text-sm font-medium rounded-sm transition-colors #{@filter == 'all' ? 'bg-woodsmoke-800 text-woodsmoke-50' : 'text-woodsmoke-400 hover:text-woodsmoke-200'}" do %>
          All Artists
        <% end %>
      </div>
    </div>
  </div>

  <%# Mobile alphabet strip %>
  <nav class="flex md:hidden overflow-x-auto scrollbar-hide gap-1 mb-4 pb-1">
    <% ('A'..'Z').each do |char| %>
      <% if @available_letters.include?(char) %>
        <%= link_to char, artists_path(filter: @filter, letter: char),
                    class: "flex-shrink-0 text-sm font-semibold px-2 py-1 rounded transition-colors #{@letter == char ? 'text-crusta-400 bg-woodsmoke-800' : 'text-woodsmoke-300 hover:text-crusta-400'}" %>
      <% else %>
        <span class="flex-shrink-0 text-sm font-semibold px-2 py-1 text-woodsmoke-700">
          <%= char %>
        </span>
      <% end %>
    <% end %>

    <% if @letter.present? %>
      <%= link_to "All", artists_path(filter: @filter),
                  class: "flex-shrink-0 text-xs font-semibold px-2 py-1 rounded text-crusta-400 hover:text-crusta-300 transition-colors" %>
    <% end %>
  </nav>

  <div class="flex gap-8">
    <%# Letter sidebar (desktop) %>
    <nav class="hidden md:flex flex-col gap-1 sticky top-20 self-start">
      <% ('A'..'Z').each do |char| %>
        <% if @available_letters.include?(char) %>
          <%= link_to char, artists_path(filter: @filter, letter: char),
                      class: "text-sm font-semibold px-2 py-0.5 rounded transition-colors #{@letter == char ? 'text-crusta-400 bg-woodsmoke-800' : 'text-woodsmoke-300 hover:text-crusta-400'}" %>
        <% else %>
          <span class="text-sm font-semibold px-2 py-0.5 text-woodsmoke-700">
            <%= char %>
          </span>
        <% end %>
      <% end %>

      <% if @letter.present? %>
        <div class="mt-2 border-t border-woodsmoke-800 pt-2">
          <%= link_to "All", artists_path(filter: @filter),
                      class: "text-xs font-semibold px-2 py-0.5 rounded text-crusta-400 hover:text-crusta-300 transition-colors" %>
        </div>
      <% end %>
    </nav>

    <%# Artist list %>
    <div class="flex-1 min-w-0">
      <% if @artists.empty? %>
        <p class="text-woodsmoke-500 text-center py-12">No artists found.</p>
      <% end %>

      <% @grouped_artists.each do |letter, artists| %>
        <div id="letter-<%= letter %>" class="mb-8 scroll-mt-20">
          <div class="flex items-baseline gap-3 mb-3">
            <h2 class="text-3xl font-bold text-crusta-400"><%= letter %></h2>

            <span class="text-sm text-woodsmoke-500">
              <%= artists.size %> artist<%= artists.size == 1 ? '' : 's' %>
            </span>
          </div>

          <div class="border-t border-crusta-400 mb-4"></div>

          <div class="space-y-1">
            <% artists.each do |artist| %>
              <div
                class="
                  flex flex-col sm:flex-row sm:items-center justify-between py-2 px-3 rounded-sm
                  hover:bg-woodsmoke-800/50 transition-colors gap-1 sm:gap-0
                "
              >
                <%= link_to artist.name, artist_path(artist),
                            class: "font-medium text-woodsmoke-100 hover:text-crusta-400 transition-colors" %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <%# Pagination %>
      <% if @pagy.last > 1 %>
        <div class="mt-6 flex items-center justify-center gap-3">
          <span class="text-xs text-woodsmoke-500">
            Page <%= @pagy.page %> of <%= @pagy.last %>
          </span>

          <div class="flex gap-1">
            <% if @pagy.previous %>
              <%= link_to artists_path(filter: @filter, letter: @letter, page: @pagy.previous),
                          class: "px-3 py-1.5 text-sm font-medium rounded-sm border border-woodsmoke-700 text-woodsmoke-200 hover:border-woodsmoke-500 transition-colors" do %>
                &larr; Prev
              <% end %>
            <% end %>

            <% if @pagy.next %>
              <%= link_to artists_path(filter: @filter, letter: @letter, page: @pagy.next),
                          class: "px-3 py-1.5 text-sm font-medium rounded-sm border border-woodsmoke-700 text-woodsmoke-200 hover:border-woodsmoke-500 transition-colors" do %>
                Next &rarr;
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
