<%# locals: (collection_item:, side:) %>
<% release = collection_item.release %>
<% artist = release.artist %>
<% fmt = release.release_formats.first %>
<% vinyl_svg = fmt&.vinyl_image_path %>
<% cover_thumb = release.cover_art_url || release.release_group&.cover_art_url %>
<% release_url = artist && release.release_group ? artist_release_group_release_path(artist, release.release_group, release) : nil %>

<div id="<%= side %>_item_<%= collection_item.id %>" class="flex items-center gap-2 bg-woodsmoke-925 rounded-sm p-2">
  <% thumb_class = "shrink-0 relative w-16 h-16 rounded bg-woodsmoke-900 flex items-center justify-center overflow-hidden" %>
  <% if release_url %>
    <%= link_to release_url, target: "_blank", class: thumb_class do %>
      <%= render "trades/trade_item_thumb", cover_thumb: cover_thumb, vinyl_svg: vinyl_svg, alt: release.title %>
    <% end %>
  <% else %>
    <div class="<%= thumb_class %>">
      <%= render "trades/trade_item_thumb", cover_thumb: cover_thumb, vinyl_svg: vinyl_svg, alt: release.title %>
    </div>
  <% end %>

  <div class="min-w-0 flex-1">
    <% if release_url %>
      <%= link_to release.title, release_url, target: "_blank",
          class: "text-xs text-woodsmoke-200 hover:text-woodsmoke-50 transition-colors truncate block" %>
    <% else %>
      <p class="text-xs text-woodsmoke-200 truncate"><%= release.title %></p>
    <% end %>
    <p class="text-[10px] text-woodsmoke-400 truncate"><%= artist&.name %></p>
  </div>

  <div class="shrink-0 flex flex-wrap gap-1 justify-end">
    <% if fmt&.name.present? %>
      <span class="px-1.5 py-0.5 text-[10px] bg-woodsmoke-700 text-woodsmoke-200 rounded"><%= fmt.name %></span>
    <% end %>
    <% if fmt&.color.present? %>
      <span class="px-1.5 py-0.5 text-[10px] rounded bg-crusta-500/15 text-crusta-400"><%= fmt.color %></span>
    <% end %>
    <% if collection_item.condition.present? %>
      <% condition_color = case collection_item.condition
           when 'M', 'NM', 'VG+', 'VG' then 'bg-bright-turquoise-500/15 text-bright-turquoise-400'
           when 'G+', 'G' then 'bg-crusta-500/15 text-crusta-400'
           when 'F', 'P' then 'bg-red-500/15 text-red-400'
           else 'bg-woodsmoke-800 text-woodsmoke-300'
         end %>
      <span class="px-1.5 py-0.5 text-[10px] rounded <%= condition_color %>"><%= collection_item.condition %></span>
    <% end %>
  </div>

  <%= button_to remove_item_trades_path(side: side, item_id: collection_item.id),
      method: :post,
      data: { turbo_stream: true, remove: true },
      class: "shrink-0 text-woodsmoke-500 hover:text-red-400 transition-colors cursor-pointer" do %>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
    </svg>
  <% end %>
</div>
